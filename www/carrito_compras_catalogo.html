<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="format-detection" content="telephone=no" />
        <meta name="msapplication-tap-highlight" content="no" />
        <!-- WARNING: for iOS 7, remove the width=device-width and height=device-height attributes. See https://issues.apache.org/jira/browse/CB-4323 -->
        <meta name="viewport" content="width=device-width, initial-scale=1, maximun-scale=no">

        <link rel="stylesheet" type="text/css" href="css/styleMenu.css">
        <link rel="stylesheet" type="text/css" href="fonts/fonts.css">
        <link rel="stylesheet" type="text/css" href="css/carrito_compras.css">

        <title>Carrito de compras</title>
        <script type="text/javascript" src="js/lib.js"></script>
        <script type="text/javascript" src="js/connect.js">
            //queryData(STORED_PROCEDURE, ['integer','1','string','abc','',1], function, numeroTabla)
        </script>

        <script type="text/javascript">
            window.addEventListener('load',function() {
                /////////////////////////////////////////////////
                /******** Llena combobox de categorías *********/
                var cat = document.getElementById('categoria');
                //var egoria = getByURL()['categoria']==null ? getByURL()['categoria'] : 1;
                var egoria = 1;
                var get = getByURL()['categoria'];
                if (typeof get != "undefined" && get != '') {
                    egoria = get;
                    Debug(egoria);
                }else {
                    egoria = 1
                }
                var argumentos = [
                'integer', '0',
                'integer', egoria,//categoria
                'integer','12',//Usuario
                'integer', '7',
                'string' ,  '',
                'integer',  '',
                'integer',  '',
                'integer', '4',//País
                'integer',  '',
                'integer',  '',
                'integer',  ''
                ];

                //Carga la tabla cuando se actualiza el combobox
                cat.addEventListener('change', function(){
                    var opcion = cat.value;
                    argumentos[3] = opcion;
                    queryData('USP_VBC_GET_ITEM_CATALOG', argumentos, listaArticulos, 2);
                    egoria = opcion;
                });

                queryData('USP_VBC_GET_ITEM_CATALOG', argumentos, categorias);
                function categorias(dataSet) {
                    var select_categoria = document.getElementById('categoria');
                    var rec = dataSet[0];
                    for(var idx = 0; idx < dataSet.length; idx++){
                        rec = dataSet[idx];
                        var options = document.createElement('option');
                        options.text = rec['groupName'];
                        options.value = rec['itemGroupId'];
                        select_categoria.options.add(options);
                    }
                    document.getElementById('categoria').value = egoria;
                }
                /////////////////////////////////////////////////
                /******** Carga articulos a la tabla *********/
                queryData('USP_VBC_GET_ITEM_CATALOG', argumentos, listaArticulos, 2);
                function listaArticulos(dataSet) {
                    var articulos = document.getElementById('articulos');
                    showWaitLoader('articulos');
                    var rec = dataSet[0];
                    var text = "", code = '';
                    for(var idx = 0; idx < dataSet.length; idx++){
                        rec = dataSet[idx];
                        code = rec['itemCode'];
                        text += '<tr id="TR-' +code+ '">';
                        text += '<td id="'    +code+ '"><a href="carrito_compras_detalles.html?categoria=' +egoria+ '&code=' +code+ '&price=' +
                            rec['price']+ '">' +
                            rec['itemCode'] + '</a></td><td id="DES-' +code+ '">' + 
                            rec['description'] + '</td><td id="PRE-'  +code+ '">$' + 
                            rec['price'] + '</td><td id="PUN='  +code+ '">' + 
                            rec['itemPvDistributor'] + '</td><td id="VCO-' +code+ '">' + 
                            rec['itemCvDistributor'] + '</td><td id="PSO-' +code+ '">' + 
                            rec['weight'] + '</td><td id="CAN-' +code+ '">' +
                            '<input type="number" id="TXT-'     +code+ '" placeholder="cantidad" size="7" />' +
                            '<input type="submit" class="comprar" value="Comprar" /></td>';
                        text += '</tr>';
                    }
                    articulos.innerHTML = text;
                }

            });
        </script>

    </head>
    <body>
        <div  id="page">

            <div>
                <h1>Catalogos</h1>
                <div class="menu_bar">
                    <a href="#" class="bt-menu" id="showMenu"><span class="icon-menu"></span> Menu</a>
                </div>
            </div>
            <div >
                <!-- ***************************************************** -->
                <!-- ***************************************************** -->
                <!-- ***************************************************** -->
                <div id="select-categoria">
                    <select name="categoria" id="categoria">
                        <!-- Código de la base -->
                    </select>
                    <table align="center">
                        <tbody>
                        <tr>
                            <td><input type="search" name="search" id="search" placeholder="Buscar"  /></td>
                            <td><a href="#" ><span class="icon-search"></span></a></td>
                            <td><a href="#" onClick="Href('carrito_compras.html')" ><span class="icon-cart"></span> Ir</a></td>
                        </tr>
                        </tbody>
                    </table>
                </div>
                <hr />
                <div id="catalogo" class="cat">
                    <table>
                        <thead>
                            <tr class="ui-bar-a">
                                <th >Código</th>
                                <th >Descripción</th>
                                <th >Precio</th>
                                <th >Puntos</th>
                                <th >Valor Consumible</th>
                                <th >peso</th>
                                <th >Comprar</th>
                            </tr>
                        </thead>
                        <tbody id='articulos'>
                            <!-- Datos desde la base -->
                        </tbody>
                    </table>
                </div>

                <!-- ***************************************************** -->
                <!-- ***************************************************** -->
                <!-- ***************************************************** -->
            </div>

        </div>

    <div id="deviceready" style="display: none">
        <p class="event listening">Connecting to Device</p>
        <p class="event received">Device is Ready</p>
    </div>
    
    <!-- ********  MENÚ  ******** -->
    <header>
        <nav id="menu"></nav>
    </header>
    <section id="mascara"></section>
    
    <script type="text/javascript" charset="utf-8" src="phonegap.js"></script>
    <script type="text/javascript" src="js/jquery-1.11.2.min.js"></script>
    <script type="text/javascript" charset="utf-8" src="js/classMenu.js"></script>
    <script type="text/javascript" src="js/menu.js"></script>
    <script type="text/javascript" charset="utf-8" src="js/logout.js"></script>
    <script type="text/javascript" charset="utf-8" src="js/notificaciones.js"></script>
    <script type="text/javascript"> 
            //El registro al servicio de google lo hacemos automáticamente
            app.initialize();            
            menu.cargarMenu();
    </script>
    </body>
</html>